\chapter{Metodologia Proposta}\label{cap_metod}

Neste capítulo, será apresentada a metodologia proposta para
otimizar o sistema neural de detecção de elétrons no segundo nível
de filtragem do ATLAS.

O processo de discriminação é dividido em duas etapas distintas.
Inicialmente, os sinais medidos são pré-processados (utilizando
modelos relacionados com a NLICA) para que suas características discriminantes
se tornem mais acessíveis. A seguir, as características extraídas
são utilizadas como entrada para os classificadores propriamente
ditos (que no escopo deste trabalho são classificadores neurais
supervisionados na arquitetura MLP).

Considerando que cada camada do calorímetro do ATLAS tem
propriedades físicas distintas, neste trabalho os sistemas de
discriminação podem operar de dois modos. No modo segmentado 
o processamento é realizado a nível de cada camada. No modo
não-segmentado, os sinais de todas as camadas são concatenados num
único vetor, que é utilizado como entrada para os discriminadores.

Este capítulo está organizado conforme descrito a seguir.
Inicialmente serão apresentados os parâmetros utilizados para
avaliar o desempenho dos diversos sistemas classificadores
propostos. A seguir, serão descritas as topologias e algoritmos propostos para extração
de características e, ao final, serão apresentados o procedimento
de treinamento dos discriminadores e as bases de dados utilizadas.

\section{Parâmetros de Avaliação do Desempenho}

No contexto desse trabalho, para avaliar a eficiência dos
discriminadores são utilizados a curva ROC 
(\emph{Receiver Operating Characteristic})~\cite{book:vantrees1:2001}, e o índice
SP (soma-produto)~\cite{tese:andre:2006}.

A curva ROC mostra como as probabilidades de detecção\footnote{Probabilidade de 
classificar corretamente os eventos de interesse.} e falso
alarme\footnote{Probabilidade de classificar o ruído de fundo incorretamente como evento de interesse.} 
(respectivamente PD e PF) variam com o patamar de decisão.
A eficiência de um classificador pode ser estimada a partir da
área sob a curva ROC. Quanto maior a área, mais eficiente é o
discriminador.

O índice SP é definido por~\cite{article:anjos:2006}:
%\begin{equation}\label{sp}
%    SP= \frac{(Ef_e + Ef_j)\times \sqrt{(Ef_e \times Ef_j)}}{2}
%\end{equation}
\begin{equation}\label{sp}
    SP=\sqrt{\displaystyle{\frac{Ef_e + Ef_j}{2}}\times
    \sqrt{Ef_e \times Ef_j}}
\end{equation}
onde $Ef_e=PD$ e $Ef_j=1-PF$ são as eficiências obtidas, respectivamente,
para elétrons e jatos.

O SP é utilizado como parâmetro para escolher o patamar de decisão
``ótimo" para um dado discriminador. Variando-se o patamar de
decisão em toda sua faixa de excursão (que no caso deste trabalho 
varia entre -1 e 1),
calcula-se os valores do SP correspondentes. O SP máximo indica um
patamar que apresenta alta eficiência para as duas classes.

Na Figura~\ref{roccomp1} são mostradas as distribuição das saídas
de dois classificadores (fictícios) para duas classes distintas.
Percebe-se, que no exemplo 1, há uma maior superposição entre as
distribuições das duas classes (se comparado ao exemplo 2).
Observando as curvas ROC (ver Figura~\ref{roccomp2}) geradas para
estes classificadores, percebe-se que o classificador do exemplo 2
produz uma maior área sob a curva ROC, e consequentemente maior
eficiência de discriminação (o que já era esperado a partir da
análise dos histogramas das saídas). Ainda na
Figura~\ref{roccomp2}, pode-se observar as curvas do patamar de
decisão (Y) versus o SP para os dois exemplos. Percebe-se que os
valores máximos do SP, em cada caso, aconteceram para valores
distintos do patamar. Nas curvas ROC e SP são marcados os pontos
de máximo SP e indicados os valores de PD, PF e do patamar 
ótimo para cada caso. É importante 
notar que o SP é sensível a degradação da eficiência de qualquer uma das classes.

\begin{figure}[h!]
\begin{minipage}[b]{0.48\linewidth}
  \centering
 \centerline{\epsfig{file=ex1_roc,width=8cm}}
\end{minipage}
\hfill
\begin{minipage}[b]{0.48\linewidth}
  \centering
 \centerline{\epsfig{file=ex2_roc,width=8cm}}
\end{minipage}
\caption{Histogramas das saídas de dois classificadores distintos,
Exemplo 1 à esquerda e Exemplo 2 à direita.}\label{roccomp1}
\end{figure}

\begin{figure}[h!]
\begin{minipage}[b]{0.48\linewidth}
  \centering
 \centerline{\epsfig{file=roc_comp,width=8cm}}
\end{minipage}
\hfill
\begin{minipage}[b]{0.48\linewidth}
  \centering
 \centerline{\epsfig{file=sp_comp,width=8cm}}
\end{minipage}
\caption{Curvas ROC (esquerda) e SP (direita) para dois
classificadores distintos.}\label{roccomp2}
\end{figure}

Adcionalmente a estes parâmetros,
serão realizadas comparações de desempenho em termos de algumas
variáveis físicas de interesse como energia e posição de interação
no detector (considerando os eixos $\eta$ e $\phi$ do sistema de
coordenadas do ATLAS).

\section{Extração de Características}

Relembrando o que foi descrito no Capítulo 4, neste trabalho os sinais
medidos nos calorímetros são pré-processados, em cada camada, para formação de anéis 
concêntricos de deposição de energia. Deste modo, considerando uma 
região de interesse (RoI) de tamanho fixo, são produzidos para as sete 
camadas dos calorímetros um total de 100 anéis.

Conforme mencionado no início deste capítulo, foram utilizados
dois modos distintos para extração de características:
\begin{itemize}
 \item O modo não-segmentado opera sobre os sinais em anéis gerados para todas
as camadas do calorímetro (não há distinção entre as camadas).
Para cada evento, as informações dos 100 anéis são concatenadas
num único vetor de características. Este vetor é então utilizado
como entrada para os algoritmos de aprendizado estatístico, este
procedimento é ilustrado na Figura~\ref{fig_fexg}.
  \item Alternativamente, as características discriminantes podem ser
estimadas separadamente (de modo segmentado) para os anéis
produzidos em cada camada do calorímetro. Este procedimento, em
geral, produz resultados de mais fácil interpretação física, pois
sabe-se que cada camada do calorímetro possui características
distintas como o tipo dos sensores e a granularidade das células
detectoras. A Figura \ref{fig_fexs} ilustra este procedimento.
\end{itemize}

\begin{figure}[th]
\centering
\includegraphics[width=13cm]{cap3_fex_glob}
\caption{Processo de extração de características no modo
não-segmentado.} \label{fig_fexg}
\end{figure}

\begin{figure}[th]
\centering
\includegraphics[width=11cm]{cap3_fex_seg}
\caption{Processo de extração de características no modo
segmentado.} \label{fig_fexs}
\end{figure}

Uma vantagem da abordagem segmentada, que será explorada
neste trabalho, é a possibilidade de redução no tempo de
processamento dos discriminadores. Conforme discutido
anteriormente no Capítulo~\ref{cap_atlasEtrig}, grande parte do
tempo de processamento do \emph{Neural Ringer} é dedicado ao processo de
seleção de dados e produção dos sinais em anéis. Convém notar que,
devido à configuração do sistema de filtragem, as informações de 
cada camada são solicitadas em bloco (ou seja, a transferência dos
dados envolve sempre toda a informação da RoI numa certa camada).

Como as camadas do calorímetro são sobrepostas, e o evento que se
desenvolve interage com todas elas, pode ocorrer algum tipo de
redundância nas informações produzidas nos diversos segmentos.
Neste trabalho, será realizado um estudo visando identificar as
camadas que apresentam informação redundante, e verificar qual a
economia obtida no tempo de processamento se as camadas
redundantes forem descartadas.

\subsection{Algoritmos de Extração de Características}\label{sec_fex5}

Este trabalho está focado na utilização do modelo não-linear da
análise de componentes independentes (NLICA) para extrair
características relevantes do sinais dos calorímetros para a
discriminação elétron/jato.

Considerando os diversos algoritmos e modelos existentes para a
estimação da NLICA (mostrados no Capítulo~\ref{cap_ica}), no
contexto deste trabalho, foram utilizados três configurações:
\begin{itemize}
 \item um algoritmo para o modelo sem restrições estruturais, neste caso foram utilizados mapas auto-organizáveis - SOM;
 \item algoritmos que estimam o modelo pós não-linear (PNL);
 \item adicionalmente, foi utilizado o modelo da ICA Local.
\end{itemize}

Foram utilizados também algumas das modificações que incluem
informação supervisionada no processo de estimação dos componentes
independentes (conforme detalhado na seção~\ref{sec_icasup}).
Neste contexto, foram testadas duas possibilidades:
\begin{itemize}
 \item utilização dos rótulos de classe como entrada para os algoritmos;
 \item estimação de modelos diferentes para cada classe.
\end{itemize}

As configurações listadas acima foram escolhidas com o objetivo de
explorar os principais modos de estimação da NLICA (modelos com
restrições estruturais ou modelos livres), através de algoritmos
com aplicação difundida (PNL e SOM).

\section{Classificação}

Neste trabalho, foram utilizados classificadores neurais tipo
perceptrons de múltiplas camadas (MLP)~\cite{haykin:nn:2008}. Mais
detalhes sobre classificação de sinais e a implementação de
classificadores neurais supervisionados podem ser encontrados no
Apêndice~\ref{apend_clas}. Os classificadores, assim como os
algoritmos de extração de características, podem ser aplicados nos
modos não-segmentado e segmentado.

De modo semelhante ao descrito na seção~\ref{sec_fex5}, na
classificação não-segmentada, as características estimadas (sejam
segmentadas ou não-segmentadas) são concatenadas num único vetor,
que é usado como entrada para o classificador neural
supervisionado (ver Figura~\ref{fig_clasg}).

\begin{figure}[h!]
\centering
\includegraphics[width=8cm]{cap3_clas_glo}
\caption{Decisão utilizando classificador global.}
\label{fig_clasg}
\end{figure}

Quando as características são extraídas de modo segmentado (para
cada camada), há a possibilidade de realizar o processo de
classificação também de modo segmentado, ou seja, treinando
classificadores específicos para cada camada. Neste caso, são
utilizadas sete redes MLP, cada uma especialista nas informações
de uma das camadas do calorímetro (ver Figura~\ref{fig_classeg}).
%
%Considerando o sistema de calorímetros do detector ATLAS, a
%informação disponível está segmentada em diversas camadas com
%características físicas e granularidade diferentes. Para melhor
%explorar as características do detector, está sendo proposto o uso
%de um conjunto de classificadores neurais, cada um especialista na
%informação de uma camada do calorímetro

\begin{figure}[th]
\centering
\includegraphics[width=10.6cm]{cap3_clas_seg}
\caption{Decisão utilizando classificadores segmentados.}
\label{fig_classeg}
\end{figure}

Um problema que surge na utilização de múltiplos classificadores é
como combinar suas saídas para produzir a decisão final, o modo
como este tópico foi tratado neste trabalho será descrito na
próxima seção.

\subsection{Combinação de Múltiplos Classificadores}

A depender do tipo de saída escolhida para os classificadores,
sendo va\-riá\-veis contínuas (com excursão de -1 a 1) ou
va\-riá\-veis discretas (rótulos de classe), a combinação pode ser
realizada através de estratégias
distintas~\cite{kuncheva:comb:2004}.

Considerando K classificadores com saídas contínuas $u_k$, uma
forma usualmente utilizada para combinação é a média das saídas:
\begin{equation}\label{med}
    \mu (\mathbf{x}) = \sum_{k=1}^K u_k (\mathbf{x})
\end{equation}

Considerando que os múltiplos classificadores apre\-sentam
eficiência diferente, pode-se dar aos mais eficientes maior poder
de decisão com o uso de fatores de ponderação $\alpha_k$:
\begin{equation}\label{medpon}
    \mu (\mathbf{x}) = \sum_{k=1}^K \alpha_k u_k (\mathbf{x})
\end{equation}

Outra forma para a combinação de classificadores de saídas
contínuas $u_k$ é o cálculo da média geométrica:
\begin{equation}\label{medgeo}
    \mu (\mathbf{x}) = \sqrt[K]{\prod_{k=1}^K u_k
    (\mathbf{x})}
\end{equation}

Alternativamente, considerando que a saída dos múltiplos
classificadores é o rótulo de classe associado ao vetor de entrada
$\mathbf{x}$, um método muito utilizado para combinação das
informações é a votação da maioria~\cite{kuncheva:comb:2004}.
Neste caso, também podem ser utilizados fatores de ponde\-ração,
caso as eficiências dos classificadores sejam diferentes. Deste
modo, o voto de um classificador mais eficiente tem mais
influência na decisão final.

Considerando que neste trabalho os classificadores são redes MLP,
é possível utilizar as saídas das camadas ocultas dos diversos
classificadores como entradas para um outro classificador.
Conforme ilustrado na Figura~\ref{fig_rede3Cam}, é formada uma
rede MLP de 3 camadas de neurônios, porém, a camada de entrada não
é totalmente conectada.

\begin{figure}[th]
\centering
\includegraphics[width=11cm]{rede3cam}
\caption{Curvas ROC para os diferentes modos de combinação dos
classificadores segmentados.} \label{fig_rede3Cam}
\end{figure}

\subsubsection{Estudo a Respeito dos Métodos de Combinação de Classificadores}

No trabalho~\cite{simas:cbrn09:fisica}, foi realizado um estudo a
respeito do desempenho dos métodos de combinação de
classificadores. Foram treinados classificadores neurais
especialistas na informação de cada camada do calorímetro. Neste
estudo não foi utilizado pré-processamento por ICA/NLICA, as redes
MLP foram alimentadas diretamente com os sinais em anéis.

As saídas dos classificadores foram combinadas a partir da média
(aritimética), média geométrica e votação. Para os três modos de
combinação foi realizada a ponderação a partir do índice SP máximo
obtido por cada classificador, conforme ilustrado na
Tabela~\ref{tab_compSegC}.

\begin{table}[h!]
\centering \caption{Comparação de desempenho dos classificadores
segmentados.}\vspace{0.2cm} \footnotesize
\begin{tabular}{c|c c c c c c c}
    \hline
     \textbf{Camada} &\textbf{PS} &\textbf{E1} &\textbf{E2} &\textbf{E3} &\textbf{H0} &\textbf{H1} &\textbf{H2}\\
    \hline
    \textbf{Max. SP}$\times$100 & 64,9 & 95,1 & 88,8 & 58,7 & 66,7 & 49,6 & 37,8 \\ \hline
\end{tabular}
\label{tab_compSegC}
\end{table}

Na Figura~\ref{fig_combClas} são ilustrados os resultados (curva
ROC) obtidos para os diferentes modos de combinação. No caso da
combinação por votação, não é possível traçar a curva ROC, pois as
saídas dos classificadores são consideradas como variáveis
discretas (indicando a classe associada a cada assinatura).
Observa-se que a combinação baseada na média (aritmética)
apresenta o melhor desempenho. Nos resultados apresentados neste
trabalho será utilizada a combinação a partir da média ponderada.

\begin{figure}[th]
\centering
\includegraphics[width=9cm]{comp_combtese}
\caption{Curvas ROC para os diferentes modos de combinação dos
classificadores segmentados.} \label{fig_combClas}
\end{figure}


\section{Especificações de Treinamento}

Neste trabalho, foram utilizados classificadores neurais
supervisionados na arquitetura Perceptron de Múltiplas camadas
(MLP - \textit{Multi-Layer Perceptron})~\cite{haykin:nn:2008}. Em
geral, foram utilizadas redes com uma camada oculta e um neurônio
na camada de saída. Todos os neurônios utilizam funções de
ativação tipo tangente hiperbólica.

Para o treinamento dos classificadores, foi utilizado o algoritmo
RPROP (\textit{Resilient
Back-propagation})~\cite{article:rprop:1993}. E a inicialização
dos pesos foi realizada através do algoritmo
\textit{Nguyen-Widrow}~\cite{article:widrow:1990} Ao final do
treinamento, são apresentados os pesos sinápticos da configuração
de melhor desempenho para a figura de mérito utilizada (de acordo
com o critério \textit{save the best}).

Em um trabalho anterior\cite{tese:torres:2010}, foi realizado um
estudo detalhado a respeito dos critérios de treinamento ótimos
para o problema da seleção de elétrons no L2 do ATLAS considerando
parâmetros como a figura de mérito para treinamento do
classificador, o número ótimo de eventos na batelada, o número de
épocas que garante a convergência do treinamento e o critério de
parada. A Tabela~\ref{tab_treinoEsp} resume os resultados obtidos,
que também foram adotados como valores de referência neste
trabalho.

\begin{table}[h!]
\centering \caption{Comparação de desempenho para diferentes
discriminadores, corte E10.}\vspace{0.2cm} \footnotesize
\begin{tabular}{c|c}
    \hline
     \textbf{Parâmetro}&\textbf{Valor} \\
    \hline
    \textbf{Figura de mérito} & SP \\ \
    \textbf{Tamanho da batelada} & 6.000 eventos por classe \\
    \textbf{Número de épocas} & 10.000 \\
    \textbf{Critério de parada} & Máximo número de épocas \\
    \textbf{Núm. Neurônios Ocultos} & 10 \\ \hline
\end{tabular}
\label{tab_treinoEsp}
\end{table}

Para avaliar a flutuação estatística inerente aos dados, o
treinamento dos discriminadores foi realizado a partir do processo
de validação cruzada~\cite{haykin:nn:2008} descrito a seguir:

\begin{enumerate}
    \item Os sinais disponíveis (para cada classe) são divididos de modo
aleatório em 12 grupos (com aproximadamente a mesma quantidade de
eventos em cada um).
    \item Sorteia-se 4 grupos (em cada classe) para compor o
conjunto de treino, 4 para o conjunto de validação e outros 4 para
o de teste.
    \item O procedimento de treinamento é realizado.

    \item O resultado é armazenado e o treinamento re-iniciado até
    completar 10 inicializações.
\end{enumerate}

Os algoritmos de extração de características (NLICA) também são
re-iniciados a cada sorteio assim como os classificadores neurais.

\section{Bases de Dados}

Neste trabalho, serão utilizadas bases de dados de características
distintas. Toda fase de projeto e teste dos discriminadores foi
iniciada antes do LHC entrar em operação, então, para estas
tarefas foram empregados sinais simulados. A plataforma de
\textit{software} do sistema de filtragem do ATLAS (ATHENA)
permite a produção de dados simulados onde são consideradas as
características das colisões do LHC e a interação com o detector
ATLAS (e seus diferentes subdetectores). É possível também
configurar diferentes estratégias de seleção para o primeiro nível
de filtragem, simulando diversos cenários de operação do detector.

A partir do final de 2009, o LHC entrou novamente em operação,
após uma interrupção para reparos (em setembro de 2008 foi
identificado um vazamento de gás Hélio do sistema de refrigeração
para o túnel do LHC, comprometendo a segurança do acelerador). Foi
estabelecido um cronograma para o comissionamento do acelerador,
que contenpla a gradual elevação na energia dos feixes de prótons.
Ainda em novembro de 2009 o LHC atingiu 1,18~TeV e definiu um novo
recorde mundial (que até aquele momento era de 0.98~TeV, alcançado
pelo acelerador Tevatron no Fermilab). No início de 2010 a energia
foi elevada para 3~TeV e atualmente está na faixa de 7~TeV (apenas
metade da energia de projeto que é de aproximadamente 14~TeV).

Com o início das colisões, foi possível adquirir dados
experimentais. Uma particularidade destes sinais é que eles tem
características físicas um pouco diferentes dos sinais simulados,
pois a faixa de energia é mais baixa. Conforme mostrado
anteriormente no Capítulo~\ref{cap_atlas}, a resolução dos
calorímetros aumenta com a energia. Um outro problema que surge em
baixa energia é que a relação sinal/ruído é mais baixa.

Uma outra classe de sinais utilizada para teste dos
discriminadores propostos são as assinaturas de raios cósmicos.
Essas partículas, originadas fora da atmosfera terrestre, são
altamente energéticas e capazes de penetrar na crosta terrestre
atingindo o ATLAS a 100 metros de profundidade. É necessário
verificar a robustez dos algoritmos propostos quanto a rejeição
das assinaturas de raios cósmicos.

Nos próximos capítulos serão mostrados os resultados obtidos neste
trabalho, iniciando com os dados simulados, e em seguida os sinais
experimentais.
